# Интерфейс отчётов

## Описание

Модуль отчётов предоставляет квартальную статистику по работе гостиницы.

**Требует авторизации:** Да

## Страница отчётов

**Путь:** `/reports`

**Компонент:** `ReportsView.vue`

### Функционал

- Выбор года и квартала
- Формирование квартального отчёта
- Отображение общей статистики
- Статистика по этажам
- Детальная таблица доходов по номерам
- Визуализация топ-10 номеров

## Параметры отчёта

| Параметр | Тип | Описание |
|----------|-----|----------|
| Год | number | Год отчёта |
| Квартал | select | 1-4 квартал |

### Кварталы

| Квартал | Период |
|---------|--------|
| 1 | Январь — Март |
| 2 | Апрель — Июнь |
| 3 | Июль — Сентябрь |
| 4 | Октябрь — Декабрь |

## Результаты отчёта

### Общая информация

Три карточки с ключевыми показателями:

1. **Период** — даты начала и конца квартала
2. **Общий доход** — сумма доходов за период
3. **Всего номеров** — количество номеров

### Статистика по этажам

Карточки с количеством номеров на каждом этаже.

### Таблица доходов по номерам

| Колонка | Описание |
|---------|----------|
| Номер | Номер комнаты |
| Тип | Тип номера |
| Этаж | Этаж |
| Гостей | Количество гостей за период |
| Доход | Сумма дохода |

### Визуализация

Progress-бары показывают относительный доход топ-10 номеров.

## API endpoint

### Квартальный отчёт

```
GET /api/reports/quarterly/?year=2024&quarter=1
Authorization: Token xxx

Response:
{
  "period": {
    "year": 2024,
    "quarter": 1,
    "start_date": "2024-01-01",
    "end_date": "2024-03-31"
  },
  "rooms": [
    {
      "room_number": "101",
      "room_type": "Одноместный",
      "floor": 1,
      "guests_count": 5,
      "income": 125000
    },
    ...
  ],
  "floors_statistics": [
    { "floor": 1, "rooms_count": 10 },
    { "floor": 2, "rooms_count": 12 },
    ...
  ],
  "total_income": 1500000,
  "total_rooms": 50
}
```

## Расчёт дохода

Для каждого номера доход рассчитывается по формуле:

```
Доход = Σ (дни_проживания × стоимость_за_сутки)
```

Где дни_проживания учитывают:
- Пересечение периода проживания гостя с периодом квартала
- Максимальная дата начала: max(дата_заселения, начало_квартала)
- Минимальная дата конца: min(дата_выселения, конец_квартала)

## Форматирование валюты

```javascript
const formatCurrency = (value) => {
  return new Intl.NumberFormat('ru-RU', {
    style: 'currency',
    currency: 'RUB',
    minimumFractionDigits: 0,
  }).format(value)
}

// Пример: 1500000 → "1 500 000 ₽"
```

## Пример использования

```javascript
import { reportsAPI } from '@/api'

// Получение квартального отчёта
const response = await reportsAPI.getQuarterly(2024, 1)
const report = response.data

console.log(`Общий доход: ${report.total_income}`)
console.log(`Номеров: ${report.total_rooms}`)

// Топ-3 номера по доходу
const top3 = report.rooms
  .sort((a, b) => b.income - a.income)
  .slice(0, 3)
```

## Требования

- Пользователь должен быть авторизован
- Токен передаётся в заголовке Authorization
- При отсутствии авторизации — редирект на страницу входа
